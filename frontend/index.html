<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Gym Planner â€” Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto}</style>
</head>

<body class="bg-slate-50 min-h-screen">
  <div class="max-w-6xl mx-auto p-6">

    <!-- HEADER -->
    <header class="mb-10 flex flex-col items-center text-center">
      <h1 class="text-3xl font-bold text-slate-800">Gym Planner</h1>
      <p class="text-sm text-slate-600 mt-1 font-semibold">By Akmal Ashique</p>
      <p class="text-sm text-slate-500 mt-1">Track workouts â€¢ Log meals â€¢ See progress</p>
    </header>

    <!-- MAIN BOXES -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <a href="/frontend/schedule.html" class="block bg-white rounded-2xl shadow-lg p-6 text-center">
        <h3 class="text-lg font-semibold text-slate-800">Schedule</h3>
        <div class="mt-4">
          <span class="inline-block px-4 py-2 bg-indigo-600 text-white rounded-md">Open schedule</span>
        </div>
      </a>

      <a href="/frontend/meals.html" class="block bg-white rounded-2xl shadow-lg p-6 text-center">
        <h3 class="text-lg font-semibold text-slate-800">Add Meal</h3>
        <div class="mt-4">
          <span class="inline-block px-4 py-2 bg-emerald-600 text-white rounded-md">Log meal</span>
        </div>
      </a>

      <a href="/frontend/progress.html" class="block bg-white rounded-2xl shadow-lg p-6 text-center">
        <h3 class="text-lg font-semibold text-slate-800">Progress</h3>
        <div class="mt-4">
          <span class="inline-block px-4 py-2 bg-violet-600 text-white rounded-md">See progress</span>
        </div>
      </a>
    </section>

    <!-- WORKOUTS + CALORIES -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <section class="lg:col-span-2 bg-white rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-3">Today's Workouts</h2>
        <div id="workouts-list" class="space-y-3 text-slate-700">
          <div class="text-sm text-slate-400">Loadingâ€¦</div>
        </div>
      </section>

      <aside class="bg-white rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-3">Today's Calories</h2>
        <div class="text-slate-700">
          <div id="calories-total" class="text-4xl font-bold text-slate-900">â€” kcal</div>
          <div id="meal-list" class="mt-4 space-y-2 text-sm text-slate-600"></div>
        </div>
      </aside>
    </main>

    <!-- ðŸ“ TODAY'S TRAINING NOTES -->
    <section class="bg-white rounded-xl shadow p-6 mt-6">
      <h2 class="text-lg font-semibold text-slate-800 mb-3">Todayâ€™s Training Notes</h2>

      <textarea
        id="daily-note"
        rows="4"
        placeholder="How did todayâ€™s workout feel? Strength, energy, pain, PRs, form notesâ€¦"
        class="w-full rounded-md border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
      ></textarea>

      <div class="flex justify-end mt-3">
        <button
          id="save-note"
          class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700"
        >
          Save Note
        </button>
      </div>

      <p id="note-msg" class="text-sm text-emerald-600 mt-2 hidden">
        Note saved âœ”
      </p>
    </section>

  </div>

<script>
/* ===== DAILY TRAINING NOTES ===== */
const noteInput = document.getElementById("daily-note");
const saveBtn = document.getElementById("save-note");
const noteMsg = document.getElementById("note-msg");

// one note per day
const todayKey = "gym-note-" + new Date().toISOString().slice(0, 10);

// load saved note
const savedNote = localStorage.getItem(todayKey);
if (savedNote) noteInput.value = savedNote;

// save note
saveBtn.addEventListener("click", () => {
  localStorage.setItem(todayKey, noteInput.value);
  noteMsg.classList.remove("hidden");
  setTimeout(() => noteMsg.classList.add("hidden"), 2000);
});

/* ===== EXISTING DASHBOARD LOGIC ===== */
async function fetchWithFallback(urls) {
  for (const u of urls) {
    try {
      const r = await fetch(u);
      if (!r.ok) continue;
      return await r.json();
    } catch {}
  }
  return [];
}

async function fetchTodayWorkouts() {
  const data = await fetchWithFallback(['/api/workouts']);
  const box = document.getElementById('workouts-list');
  box.innerHTML = '';
  if (!data.length) {
    box.innerHTML = '<div class="text-sm text-slate-400">No workouts today</div>';
    return;
  }
  data.forEach(w => {
    const div = document.createElement('div');
    div.className = 'p-3 border rounded-lg';
    div.innerHTML = `<div class="font-medium">${w.title || 'Workout'}</div>`;
    box.appendChild(div);
  });
}

async function fetchTodayMeals() {
  const data = await fetchWithFallback(['/api/meals']);
  const today = new Date().toISOString().slice(0,10);
  const meals = data.filter(m => (m.created_at||'').startsWith(today));
  const total = meals.reduce((s,m)=>s+(m.calories||0),0);
  document.getElementById('calories-total').innerText = total + ' kcal';
}

window.onload = () => {
  fetchTodayWorkouts();
  fetchTodayMeals();
};
</script>
</body>
</html>
